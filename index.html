<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>WebSocket Sensor Data</title>
	</head>
	<body>
		<div class="container">
			<h1>Sensor Data Monitor</h1>
			<div id="output"></div>
			<div id="status"></div>
			
			<!-- ì‚¬ì§„ -->
			<img id="capturedImage" alt="Captured Photo" style="max-width:100%; margin:10px 0;" />

			<!-- ìƒíƒœ í‘œì‹œ ì˜ì—­ ì¶”ê°€ -->
			<button id="manualCleanButton">ìˆ˜ë™ ì²­ì†Œ ì‹¤í–‰</button>
		</div>

		<script>
			const ws = new WebSocket('ws://localhost:8002')

			ws.onopen = () => {
				console.log('WebSocket connection established')
			}

			ws.onmessage = message => {
				//const data = JSON.parse(message.data)
				// console.log('Received data:', data)
				// document.getElementById('output').innerText = JSON.stringify(data, null, 2)

				const msg = JSON.parse(message.data);

				if (msg.type === 'sensorUpdate') {
				output.innerText = JSON.stringify(msg.data, null, 2);
				}
				else if (msg.type === 'captureError') {
				status.innerText = `âŒ ìº¡ì²˜ ì—ëŸ¬: ${msg.data.message}`;
				}
				else if (msg.type === 'captureSuccess') {
				status.innerText = `âœ… ìº¡ì²˜ ì™„ë£Œ: ${msg.data.filename}`;
				// ìµœì‹  ì´ë¯¸ì§€ í‘œì‹œ (ìºì‹œ ë°©ì§€ìš© timestamp)
				capturedImage.src = `/${msg.data.filename}?t=${Date.now()}`;
				}

				//ì²­ì†Œì§„í–‰ì•ˆë‚´
				// if (data.type === 'sensorUpdate') {
				// 	document.getElementById('output').innerText = JSON.stringify(data.data, null, 2)
				// }

				// if (data.type === 'statusUpdate') {
				// 	const statusText =
				// 		data.data.status === 'autoCleanStarted'
				// 			? 'ğŸš¿ ìë™ ì²­ì†Œ ì§„í–‰ ì¤‘...'
				// 			: data.data.status === 'autoCleanFinished'
				// 			? 'âœ… ìë™ ì²­ì†Œ ì™„ë£Œ!'
				// 			: ''

				// 	document.getElementById('status').innerText = statusText
				// }
			}

			ws.onclose = () => {
				console.log('WebSocket connection closed')
			}

			document.getElementById('manualCleanButton').addEventListener('click', () => {
				console.log('ìˆ˜ë™ ì²­ì†Œ ìš”ì²­ ì „ì†¡')
				ws.send(
					JSON.stringify({
						type: 'manualClean',
						data: { poop: 'y' },
					}),
				)
			})
		</script>
	</body>
</html>
<style>
	.container {
		width: 90%;
		max-width: 600px;
		margin: 40px auto; /* í™”ë©´ ê°€ìš´ë°ë¡œ */
		text-align: left; /* ì•ˆì— í…ìŠ¤íŠ¸ëŠ” ì™¼ìª½ ì •ë ¬ */
	}

	h1 {
		font-size: 2.5rem;
		color: #333;
		font-weight: bold;
		margin-bottom: 20px;
	}

	#output {
		white-space: pre-wrap;
		font-family: monospace;
		background-color: #f4f4f4;
		padding: 20px;
		border-radius: 10px;
		margin-bottom: 20px;
	}

	#manualCleanButton {
		background-color: #4caf50;
		color: white;
		padding: 10px 20px;
		border: none;
		border-radius: 5px;
		font-size: 16px;
		cursor: pointer;
		transition: background-color 0.3s ease;
	}

	#manualCleanButton:hover {
		background-color: #45a049;
	}
</style>
